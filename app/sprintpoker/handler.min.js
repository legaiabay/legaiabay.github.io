import{initializeApp}from"https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";import{getDatabase,ref,onValue,get,set,update,remove}from"https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";const G=K;function C(){const e=["438696mGVbtQ","62219lAztWT","5298wfYVfy","1814238gSCWaw","505316fOoDwd","4lvmMdm","2950acvzvC","apply","toString","constructor","335155oqpneO","AIzaSyDcIrBYSlhoWhdwu-1ka0BUY7Tbn_QwPVg","(((.+)+)+)+$","15664HuDDUY","https://sprint-poker-19cbc-default-rtdb.asia-southeast1.firebasedatabase.app/","196zpYdpk","search","sprint-poker-19cbc","9jvuTrH"];return(C=function(){return e})()}function K(e,t){const o=C();return(K=function(e,t){return o[e-=289]})(e,t)}!function(e,t){const o=K,r=C();for(;;)try{if(168562===-parseInt(o(293))/1+parseInt(o(307))/2*(parseInt(o(294))/3)+parseInt(o(297))/4*(parseInt(o(302))/5)+-parseInt(o(295))/6+-parseInt(o(296))/7+parseInt(o(292))/8*(-parseInt(o(291))/9)+-parseInt(o(298))/10*(-parseInt(o(305))/11))break;r.push(r.shift())}catch(e){r.push(r.shift())}}();const s=function(){let e=!0;return function(t,o){const r=e?function(){if(o){const e=o[K(299)](t,arguments);return o=null,e}}:function(){};return e=!1,r}}(),P=s(this,(function(){const e=K;return P[e(300)]()[e(289)](e(304))[e(300)]()[e(301)](P).search("(((.+)+)+)+$")}));P();const firebaseConfig={apiKey:G(303),authDomain:"sprint-poker-19cbc.firebaseapp.com",projectId:G(290),databaseURL:G(306)},app=initializeApp(firebaseConfig),db=getDatabase(app);var _room=null,_roomCode="",_userName="",_isShow=!1,_isRoomMaster=!1;window.addEventListener("DOMContentLoaded",(()=>{let e=new URLSearchParams(window.location.search).get("room");null!=e&&(document.querySelector("#menuMain").classList.add("hide"),document.querySelector("#menuJoin").classList.remove("hide"),document.querySelector("#roomCode").value=e)})),window.addEventListener("beforeunload",(()=>{quitRoom(!1)})),document.querySelector("#btnCreateRoom").addEventListener("click",(()=>{document.querySelector("#menuMain").classList.add("hide"),document.querySelector("#menuCreate").classList.remove("hide")})),document.querySelector("#btnJoinRoom").addEventListener("click",(()=>{document.querySelector("#menuMain").classList.add("hide"),document.querySelector("#menuJoin").classList.remove("hide")})),document.querySelector("#btnCreateBack").addEventListener("click",(()=>{document.querySelector("#menuCreate").classList.add("hide"),document.querySelector("#menuMain").classList.remove("hide")})),document.querySelector("#btnJoinBack").addEventListener("click",(()=>{document.querySelector("#menuJoin").classList.add("hide"),document.querySelector("#menuMain").classList.remove("hide")})),document.querySelector("#numberList").addEventListener("change",(e=>{"custom"==document.querySelector("#numberList").value?document.querySelector("#createRoomNumberCustom").classList.remove("hide"):document.querySelector("#createRoomNumberCustom").classList.add("hide")})),document.querySelector("#btnCreateStart").addEventListener("click",(()=>{createRoom()})),document.querySelector("#btnJoinStart").addEventListener("click",(()=>{joinRoom()})),document.querySelector("#btnShowNumber").addEventListener("click",(()=>{showResult(!0)})),document.querySelector("#btnResetNumber").addEventListener("click",(()=>{resetResult(!0)})),document.querySelector("#btnRoomQuit").addEventListener("click",(()=>{quitRoom(!0)}));const listenRoom=()=>{onValue(ref(db,"rooms/"+_roomCode),(e=>{_room=e.val(),generateParticipants(_userName,_room.participants,_isRoomMaster);let t=_room.isShow;t!=_isShow&&(_isShow=t,!0===t?showResult(!1):resetResult(!1))}))},getRoom=async e=>new Promise((t=>{get(ref(db,"rooms/"+e)).then((e=>{null==e.val()&&t(!1),t(e.val())}))})),createRoom=async()=>{let e=document.querySelector("#roomName").value,t=document.querySelector("#roomMaster").value,o=document.querySelector("#numberList").value;if("custom"==o&&(o=document.querySelector("#numberCustomList").value),isEmpty(e)||isEmpty(t)||isEmpty(o))return void alert("all input required");let r=generateRoomId(),n={title:e,numberList:o,master:t,isMasterLoggedIn:!0,isShow:!1,createdAt:Date.now()};set(ref(db,"rooms/"+r),n),setRoomCodeTitle(r),setRoomTitle(e),setRoomMasterTitle(t,r),generateNumberListBtn(generateNumberList(o)),document.querySelector("#menuCreate").classList.add("hide"),document.querySelector("#menuRoom").classList.remove("hide"),_room=n,_roomCode=r,_isRoomMaster=!0,listenRoom()},joinRoom=async()=>{let e=document.querySelector("#userName").value,t=document.querySelector("#roomCode").value;if(isEmpty(e)||isEmpty(t))return void alert("input empty");let o=await getRoom(t);if(!o)return void alert("room not found");let r=o.participants,n=e==o.master;if(n&&o.isMasterLoggedIn)alert("master is already logged in");else{if(n&&!o.isMasterLoggedIn&&setRoomMasterLoginStatus(o,t,!0),!isEmpty(r)&&!n){if(null!=r[e])return void alert("username is already used")}setRoomCodeTitle(t),setRoomTitle(o.title),setRoomMasterTitle(o.master,t),generateParticipants(e,r,n),generateNumberListBtn(generateNumberList(o.numberList)),document.querySelector("#menuJoin").classList.add("hide"),document.querySelector("#menuRoom").classList.remove("hide"),n?document.querySelector("#navbarNumber").classList.add("hide"):(document.querySelector("#btnShowNumber").classList.add("hide"),document.querySelector("#navbarNumber").classList.remove("hide")),n||createParticipant(e,t),_roomCode=t,_userName=e,_room=o,_isRoomMaster=n,listenRoom()}},quitRoom=e=>{_isRoomMaster?setRoomMasterLoginStatus(_room,_roomCode,!1):remove(ref(db,"rooms/"+_roomCode+"/participants/"+_userName)),document.querySelector("#navbarNumber").classList.add("hide"),e&&(window.location=window.location.protocol+"//"+window.location.host+window.location.pathname)},showResult=e=>{1==e&&blastShowResult(),_isRoomMaster&&(document.querySelector("#btnShowNumber").classList.add("hide"),document.querySelector("#btnResetNumber").classList.remove("hide")),document.querySelectorAll(".card-number-parent").forEach((e=>{e.classList.add("card-number-show-m1"),setTimeout((()=>{document.querySelectorAll(".card-number").forEach((e=>{let t=e.getAttribute("data-username"),o=_room.participants[t].cardSelectedVal;e.innerHTML=o,e.classList.add("card-number-show-text")}))}),500)}))},resetResult=e=>{1==e&&blastResetResult(),_isRoomMaster&&(document.querySelector("#btnShowNumber").classList.remove("hide"),document.querySelector("#btnResetNumber").classList.add("hide")),document.querySelectorAll(".card-number-parent").forEach((e=>{e.classList.remove("card-number-show-m1"),document.querySelectorAll(".card-number").forEach((e=>{e.innerHTML=e.getAttribute("data-icon"),e.classList.remove("card-number-show-text")}))}))},blastShowResult=()=>{let e=_room;e.isShow=!0;let t={};t["rooms/"+_roomCode]=e,update(ref(db),t)},blastResetResult=()=>{let e=_room;e.isShow=!1;for(let t in e.participants)e.participants[t].cardSelectedVal="";let t={};t["rooms/"+_roomCode]=e,update(ref(db),t)},createParticipant=(e,t)=>{set(ref(db,"rooms/"+t+"/participants/"+e),{cardSelectedVal:"",cardIcon:generateRandomCardIcon()})},generateNumberListBtn=e=>{let t="";for(let o=0;o<e.length;o++)t+=`<button type="button" class="btn btn-info btn-number" data-number="${e[o]}">${e[o]}</button>&nbsp;&nbsp;`;document.querySelector("#numberSelectList").innerHTML=t,document.querySelectorAll(".btn-number").forEach((e=>{e.addEventListener("click",(()=>{setCardNumber(_userName,_roomCode,e.getAttribute("data-number"))}))}))},generateNumberList=e=>e.split(","),generateParticipants=(e,t,o)=>{let r=[];isEmpty(e)||o||r.push({username:e,numberSelected:isEmpty(t)||isEmpty(t[e])||isEmpty(t[e].cardSelectedVal)?"":"card-number-selected",cardIcon:isEmpty(t)||isEmpty(t[e])||isEmpty(t[e].cardIcon)?"":t[e].cardIcon}),isEmpty(t)||Object.keys(t).forEach((o=>{o!=e&&r.push({username:o,numberSelected:isEmpty(t[o].cardSelectedVal)?"":"card-number-selected",cardIcon:isEmpty(t[o].cardIcon)?"":t[o].cardIcon})}));let n="",a="";for(let t=0;t<r.length;t++)a=r[t].username,0==t&&r[t].username==e&&(a="⭐ "+a),n+=`\n            <div class="col-3 col-lg-2 text-center">\n                <div class="card card-number-parent ${r[t].numberSelected}">\n                    <div class="card-number-box">\n                        <h5 class="card-title card-number" data-icon="${r[t].cardIcon}" data-username="${r[t].username}">${r[t].cardIcon}</h5>\n                    </div>\n                </div>\n                <div class="card-participant-box">\n                    <h5 class="card-title card-participant">\n                        ${a}\n                    </h5>\n                </div>\n            </div>\n        `;document.querySelector("#participantList").innerHTML=n},generateRoomId=()=>(Math.random()+1).toString(36).substring(6),generateRandomCardIcon=()=>{switch(Math.floor(4*Math.random())){case 0:return"♥️";case 1:return"♠️";case 2:return"♣️";case 3:return"♦️";default:return"?"}},setRoomCodeTitle=e=>{new ClipboardJS(".btn-copy");let t=window.location.protocol+"//"+window.location.host+window.location.pathname+"?room="+e;document.querySelector("#roomCodeTitle").innerHTML=`\n        <input id="roomCodeInput" type="hidden" value="${t}"></input>\n        <button id='roomCopyLink' type='button' class='btn btn-copy btn-primary' data-clipboard-target='#roomCodeInput'>🔗 copy</button>\n    `,document.querySelector("#roomCopyLink").addEventListener("click",(()=>{alert("link copied")}))},setRoomTitle=e=>{document.querySelector("#roomTitle").innerHTML=e},setRoomMasterTitle=(e,t)=>{document.querySelector("#roomMasterTitle").innerHTML="master : "+e+" | code : "+t},setRoomMasterLoginStatus=(e,t,o)=>{let r=e;r.isMasterLoggedIn=o,o||(r.isShow=!1);let n={};n["rooms/"+t]=r,update(ref(db),n)},setCardNumber=(e,t,o)=>{let r=_room.participants[e];r.cardSelectedVal=o;let n={};n["rooms/"+t+"/participants/"+e]=r,update(ref(db),n)},isEmpty=e=>""==e||null==e||null==e;