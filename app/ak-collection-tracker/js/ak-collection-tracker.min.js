const VERSION="v.1.4.8",CAPTURE_PADDING="1em";var selected_server="cn",current_total_operator=0,current_total_operator_en=0,selected_count=0,selected_chara=[],selected_chara_all=[],selected_chara_all_en=[],total_chara_rarity=[0,0,0,0,0,0],total_chara_rarity_en=[0,0,0,0,0,0],chara_rarity_count=[0,0,0,0,0,0],background_color="#1b262c";ready=(e=>{"loading"!=document.readyState?e():document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.attachEvent("onreadystatechange",()=>{"loading"!=document.readyState&&e()})});let changeBackgroundColor=e=>{background_color=e,document.querySelectorAll(".bg-color").forEach(t=>{t.style.backgroundColor=e}),localStorage.setItem("background-color",e)},loadLocalStorage=()=>{let e=localStorage.getItem("selected"),t=localStorage.getItem("server"),r=localStorage.getItem("server_en"),a=localStorage.getItem("ign"),c=localStorage.getItem("background-color");e=null==e||""==e[0]||0===e.length?[]:e.split(",");for(let t=0;t<e.length;t++){e[t]=parseInt(e[t]);let r=document.querySelector(`.chara-img-btn[data-id='${e[t]}']`),a=r.getAttribute("data-rarity");r.style.background="white",r.setAttribute("data-selected",!0),selected_count++,chara_rarity_count[a-1]++,document.querySelector("#rarity-"+a).innerHTML=chara_rarity_count[a-1],document.querySelectorAll(".selected").forEach(e=>{e.innerHTML=selected_count})}selected_chara=e,""!=t&&null!=t&&(setServer(t),"en"==t&&document.querySelector("#server").setAttribute("checked",!0)),""!=r&&null!=r&&(document.querySelector(".selected-server-2").innerHTML=r,"EN"==r?document.querySelector("#server-en").setAttribute("checked",!0):"JP"==r?document.querySelector("#server-jp").setAttribute("checked",!0):"KR"==r&&document.querySelector("#server-kr").setAttribute("checked",!0)),""!=a&&null!=a&&(document.querySelector("#ign-input").value=a,document.querySelector("#ign").innerHTML="IGN : "+a),""!=c&&null!=c&&changeBackgroundColor(c)},setServer=e=>{"en"==e?(selected_server="en",document.querySelectorAll(".chara-img-btn[data-server='1']").forEach(e=>{e.parentNode.style.display="none"}),document.querySelectorAll(".chara-img-btn[data-server='1'][data-selected=false]").forEach(e=>{e.style.backgroundColor="rgba(0,0,0,0)"}),document.querySelectorAll(".server-non-cn").forEach(e=>{e.style.display="flex"}),document.querySelector("#server-en").checked=!0,document.querySelectorAll(".selected-server").forEach(e=>{e.innerHTML="EN/JP/KR"}),document.querySelectorAll(".selected-server-2").forEach(e=>{e.innerHTML="EN"}),document.querySelectorAll(".total-operator").forEach(e=>{e.innerHTML=current_total_operator_en}),total_chara_rarity_en.forEach((e,t)=>{document.querySelector("#rarity-"+(t+1)+"-total").innerHTML="/"+e})):"cn"==e&&(selected_server="cn",document.querySelectorAll(".chara-img-btn[data-server='1']").forEach(e=>{e.parentNode.style.display="flex"}),document.querySelectorAll(".server-non-cn").forEach(e=>{e.style.display="none"}),document.querySelectorAll(".selected-server, .selected-server-2").forEach(e=>{e.innerHTML="CN"}),document.querySelectorAll(".total-operator").forEach(e=>{e.innerHTML=current_total_operator}),total_chara_rarity.forEach((e,t)=>{document.querySelector("#rarity-"+(t+1)+"-total").innerHTML="/"+e}),localStorage.setItem("server_en","")),localStorage.setItem("server",e)},createCharaDiv=e=>{let t="";switch(e.class){case"Caster":t="caster.png";break;case"Defender":t="defender.png";break;case"Guard":t="guard.png";break;case"Medic":t="medic.png";break;case"Sniper":t="sniper.png";break;case"Specialist":t="specialist.png";break;case"Supporter":t="supporter.png";break;case"Vanguard":t="vanguard.png"}return`\n        <div class="col-lg-2 col-md-3 col-4 text-center">            \n            <button class="chara-img-btn" data-selected="false" data-id=${e.id} data-rarity=${e.rarity} data-server=${e.server}>\n                <div class="chara-img-box">\n                    <img class="chara-img disable-drag" src="${location.pathname}/img/ak/avatars/${e.image}.png" loading="lazy" width="128" height="128" alt="${e.name}">\n                    <img class="chara-img-class disable-drag" src="${location.pathname}/img/ak/classes/${t}">                \n                </div>\n            </button>\n        </div>\n    `},setChangelog=()=>{fetch(`${location.pathname}changelog.json`).then(e=>e.json()).then(e=>{e.changelog.reverse(),e.changelog.forEach(e=>{document.querySelectorAll(".changelog-body").forEach(t=>{t.insertAdjacentHTML("beforeend",`<b>Version ${e.version}</b>`)}),e.list.forEach(e=>{document.querySelector(".changelog-body").insertAdjacentHTML("beforeend","<br>- "+e)}),document.querySelector(".changelog-body").insertAdjacentHTML("beforeend","<br><br>")})})},setCharaDiv=()=>{fetch(`${location.pathname}chara-db.json`).then(e=>e.json()).then(e=>{e.chara.forEach(e=>{current_total_operator++,total_chara_rarity[e.rarity-1]++,selected_chara_all.push(parseInt(e.id)),2==e.server&&(selected_chara_all_en.push(parseInt(e.id)),current_total_operator_en++,total_chara_rarity_en[e.rarity-1]++),document.querySelectorAll(".chara-selection-"+e.rarity).forEach(t=>{t.insertAdjacentHTML("beforeend",createCharaDiv(e))})})}).then(()=>{document.querySelectorAll(".selected-server, .selected-server-2").forEach(e=>{e.innerHTML="CN"}),document.querySelectorAll(".total-operator").forEach(e=>{e.innerHTML=current_total_operator}),total_chara_rarity.forEach((e,t)=>{document.querySelector("#rarity-"+(t+1)+"-total").innerHTML="/"+e}),loadLocalStorage(),document.querySelectorAll(".chara-img-btn").forEach(e=>{e.addEventListener("click",()=>{let t=e.getAttribute("data-selected"),r=e.getAttribute("data-rarity"),a=parseInt(e.getAttribute("data-id"));"false"==t?(e.style.background="white",e.setAttribute("data-selected",!0),selected_chara.push(a),selected_count++,chara_rarity_count[r-1]++):(e.style.background="rgba(0,0,0,0)",e.setAttribute("data-selected",!1),selected_chara.splice(selected_chara.indexOf(a),1),selected_count--,chara_rarity_count[r-1]--),document.querySelector("#rarity-"+r).innerHTML=chara_rarity_count[r-1],document.querySelectorAll(".selected").forEach(e=>{e.innerHTML=selected_count}),localStorage.setItem("selected",selected_chara)},!1)})})},reset=()=>{selected_chara=[],selected_count=0,document.querySelectorAll(".selected").forEach(e=>{e.innerHTML=selected_count}),chara_rarity_count=[0,0,0,0,0,0];for(let e=1;e<=chara_rarity_count.length;e++)document.querySelector("#rarity-"+e).innerHTML="0";document.querySelectorAll(".chara-img-btn").forEach(e=>{e.style.background="rgba(0,0,0,0)",e.setAttribute("data-selected",!1)}),localStorage.setItem("selected",selected_chara)},generate=()=>{document.querySelector("#generate").style.display="none",document.querySelector(".loading-overlay").style.display="block",""===document.querySelector("#ign-input").value&&(document.querySelector("#ign").style.display="none"),document.querySelector("#capture-area").style.paddingLeft="1em",document.querySelector("#capture-area").style.paddingRight="1em",document.querySelector("#capture-area").style.paddingTop="1em",document.querySelector("#capture-area").style.paddingBottom="1em";let e=[];document.querySelector("#keep-unselected").checked||(document.querySelectorAll(".chara-img-btn").forEach(e=>{"false"==e.getAttribute("data-selected")?e.parentNode.style.display="none":e.style.background="rgba(0,0,0,0)"}),chara_rarity_count.forEach((t,r)=>{t<=0&&document.querySelectorAll(".chara-selection-"+(r+1)).forEach(e=>{e.style.display="none"}),e.push(r)})),window.scrollTo({left:0,top:document.querySelector("body").offsetTop}),html2canvas(document.querySelector("#capture-area"),{backgroundColor:background_color,width:window.innerWidth}).then(t=>{let r=(new Date).format("Ymd-his"),a=t.toDataURL("image/jpeg").replace("image/jpeg","image/octet-stream");document.querySelector("#result-img").setAttribute("src",a),document.querySelector("#result-a").setAttribute("href",a),""!==document.querySelector("#ign-input").value?document.querySelector("#result-a").setAttribute("download",`ak-collection-tracker-${document.querySelector("#ign-input").value}-${r}.jpg`):document.querySelector("#result-a").setAttribute("download",`ak-collection-tracker-${r}.jpg`),document.querySelector("#generate").style.display="initial",document.querySelector(".capture-result").style.display="initial",document.querySelector("#ign").style.display="flex",document.querySelectorAll(".chara-img-btn").forEach(e=>{"false"==e.getAttribute("data-selected")?e.parentNode.style.display="initial":e.style.background="white"}),document.querySelector("#keep-unselected").checked||e.forEach((e,t)=>{document.querySelectorAll(".chara-selection-"+(t+1)).forEach(e=>{e.style.display="flex"})}),document.querySelector("#server").checked?document.querySelectorAll(".chara-img-btn[data-server='1']").forEach(e=>{e.parentNode.style.display="none"}):document.querySelectorAll(".chara-img-btn[data-server='1']").forEach(e=>{e.parentNode.style.display="flex"}),document.querySelector(".loading-overlay").style.display="none",document.querySelector("#capture-area").style.paddingLeft="0px",document.querySelector("#capture-area").style.paddingRight="0px",document.querySelector("#capture-area").style.paddingTop="0px",document.querySelector("#capture-area").style.paddingBottom="0px",window.scrollTo({behavior:"smooth",left:0,top:document.querySelector("div.capture-result").offsetTop})})};window.ready(()=>{document.querySelectorAll(".version").forEach(e=>{e.insertAdjacentHTML("beforeend",VERSION)}),document.querySelectorAll(".style-btn").forEach(e=>{e.addEventListener("click",()=>{changeBackgroundColor(e.getAttribute("data-color"))})}),document.querySelectorAll(".selected").forEach(e=>{e.innerHTML=selected_count}),setChangelog(),setCharaDiv(),document.querySelector("#ign-input").addEventListener("keyup",()=>{document.querySelector("#ign").innerHTML="IGN : "+document.querySelector("#ign-input").value,localStorage.setItem("ign",document.querySelector("#ign-input").value)}),document.querySelector("#server").addEventListener("click",()=>{document.querySelector("#server").checked?setServer("en"):setServer("cn"),reset()}),document.querySelectorAll(".server-radio").forEach(e=>{e.addEventListener("click",()=>{let t=e.getAttribute("id");"server-en"==t?(document.querySelector(".selected-server-2").innerHTML="EN",localStorage.setItem("server_en","EN")):"server-jp"==t?(document.querySelector(".selected-server-2").innerHTML="JP",localStorage.setItem("server_en","JP")):"server-kr"==t&&(document.querySelector(".selected-server-2").innerHTML="KR",localStorage.setItem("server_en","KR"))})}),document.querySelector("#reset").addEventListener("click",()=>{reset()}),document.querySelector("#select-all").addEventListener("click",()=>{if(document.querySelectorAll(".chara-img-btn").forEach(e=>{e.setAttribute("data-selected",!0),e.style.background="white"}),"en"==selected_server){selected_chara=selected_chara_all_en,selected_count=current_total_operator_en,document.querySelectorAll(".selected").forEach(e=>{e.innerHTML=current_total_operator_en});for(let e=1;e<=chara_rarity_count.length;e++)chara_rarity_count[e-1]=total_chara_rarity_en[e-1],document.querySelector("#rarity-"+e).innerHTML=chara_rarity_count[e-1]}else if("cn"==selected_server){selected_chara=selected_chara_all,selected_count=current_total_operator,document.querySelectorAll(".selected").forEach(e=>{e.innerHTML=current_total_operator});for(let e=1;e<=chara_rarity_count.length;e++)chara_rarity_count[e-1]=total_chara_rarity[e-1],document.querySelector("#rarity-"+e).innerHTML=chara_rarity_count[e-1]}localStorage.setItem("selected",selected_chara)}),document.querySelector("#to-top").addEventListener("click",()=>{window.scrollTo({behavior:"smooth",left:0,top:document.querySelector("body").offsetTop})}),document.querySelector("#generate").addEventListener("click",()=>{generate()})});